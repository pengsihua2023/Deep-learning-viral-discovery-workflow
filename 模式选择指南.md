# å·¥ä½œæµæ¨¡å¼é€‰æ‹©æŒ‡å—

> **ğŸš¨ é‡è¦æ›´æ–° (2025-11-04)**ï¼š  
> å¦‚æœä½ çš„ **viralFlye åªè¯†åˆ« 2 ä¸ªç—…æ¯’**ï¼Œè¯·é™ä½ `viralflye_completeness` å‚æ•°ï¼  
> è¯¦è§ï¼š[viralFlye å‚æ•°ä¼˜åŒ–é‡è¦æç¤º](#-viralflye-å‚æ•°ä¼˜åŒ–é‡è¦æç¤º-)

---

## ğŸ¯ å¿«é€Ÿé€‰æ‹©

**ä½ æœ‰ä»€ä¹ˆæ•°æ®ï¼Ÿ**

```
Illumina åŒç«¯æµ‹åºï¼ˆ150-300 bpï¼‰
    â†“
ä½¿ç”¨ã€çŸ­è¯»æ¨¡å¼ã€‘

Nanopore / PacBio é•¿è¯»ï¼ˆ>1 kbï¼‰
    â†“
ä½¿ç”¨ã€é•¿è¯»æ¨¡å¼ã€‘+ å¯ç”¨ viralFlye â­
```

---

## ğŸ“Š ä¸¤ç§æ¨¡å¼è¯¦ç»†å¯¹æ¯”

### çŸ­è¯»æ¨¡å¼ï¼ˆIlluminaï¼‰

#### è®¾è®¡ç­–ç•¥ï¼šåŒæ‹¼æ¥å™¨å¹¶è¡Œ

```
Illumina Reads
     â†“
  â”Œâ”€â”€â”´â”€â”€â”
  â†“     â†“
MEGAHIT SPAdes
  â†“     â†“
  â”œâ”€VS2 â”œâ”€VS2
  â””â”€DVF â””â”€DVF
  â†“     â†“
  â””â”€â”€â”¬â”€â”€â”˜
     â†“
æ‹¼æ¥å™¨æ¯”è¾ƒ
 å…±è¯†ç—…æ¯’
```

#### æ ¸å¿ƒç‰¹ç‚¹

| ç‰¹æ€§ | å†…å®¹ |
|------|------|
| **æ‹¼æ¥å™¨** | MEGAHIT + metaSPAdesï¼ˆåŒæ‹¼æ¥å™¨å¹¶è¡Œï¼‰|
| **ç—…æ¯’è¯†åˆ«** | VirSorter2 + DeepVirFinderï¼ˆæ¯ä¸ªæ‹¼æ¥å™¨éƒ½è¿è¡Œï¼‰|
| **ç»¼åˆæ¯”è¾ƒ** | æ‹¼æ¥å™¨æ¯”è¾ƒï¼ˆMEGAHIT vs SPAdesï¼‰|
| **å…±è¯†ç­–ç•¥** | åŒæ‹¼æ¥å™¨éƒ½è¯†åˆ«çš„ç—…æ¯’ = é«˜ç½®ä¿¡åº¦ |
| **viralFlye** | âŒ **ä¸æ”¯æŒ**ï¼ˆviralFlye åªæ”¯æŒé•¿è¯»ï¼‰|

#### ä¼˜åŠ¿

- âœ… åŒæ‹¼æ¥å™¨äº¤å‰éªŒè¯
- âœ… è¯†åˆ«æ‹¼æ¥å™¨å…±è¯†ç—…æ¯’
- âœ… æ¯”è¾ƒ MEGAHIT å’Œ SPAdes çš„æ€§èƒ½
- âœ… é€‚åˆ Illumina æ•°æ®

#### è¾“å‡ºç¤ºä¾‹

```
results/
â”œâ”€â”€ assembly_megahit/             # MEGAHIT æ‹¼æ¥
â”œâ”€â”€ assembly_spades/              # SPAdes æ‹¼æ¥
â”œâ”€â”€ virsorter2_megahit/           # VS2 (MEGAHIT)
â”œâ”€â”€ virsorter2_spades/            # VS2 (SPAdes)
â”œâ”€â”€ deepvirfinder_megahit/        # DVF (MEGAHIT)
â”œâ”€â”€ deepvirfinder_spades/         # DVF (SPAdes)
â”œâ”€â”€ merged_viral_reports_megahit/ # æ•´åˆæŠ¥å‘Š (MEGAHIT)
â”œâ”€â”€ merged_viral_reports_spades/  # æ•´åˆæŠ¥å‘Š (SPAdes)
â””â”€â”€ assembler_comparison/         # æ‹¼æ¥å™¨æ¯”è¾ƒ â­
    â”œâ”€â”€ sample_assembler_comparison.txt
    â””â”€â”€ sample_consensus_viral_sequences.txt  # åŒæ‹¼æ¥å™¨å…±è¯†
```

---

### é•¿è¯»æ¨¡å¼ï¼ˆNanopore/PacBioï¼‰â­

#### è®¾è®¡ç­–ç•¥ï¼šä¸‰å·¥å…·å¹¶åˆ—åˆ†æ

```
Nanopore/PacBio Reads
         â†“
    metaFlye æ‹¼æ¥
         â†“
    æ‰€æœ‰ contigs
         â†“
   â”Œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”
   â†“     â†“     â†“
  VS2   DVF  viralFlye
  ç—…æ¯’  æœºå™¨  Pfam
  ç‰¹å¾  å­¦ä¹   éªŒè¯
   |     |     |
   â””â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”˜
         â†“
  ä¸‰å·¥å…·ç»¼åˆæ¯”è¾ƒ
   - ä¸‰å·¥å…·å…±è¯† â­â­â­
   - ä¸¤å·¥å…·å…±è¯† â­â­
   - å•å·¥å…·è¯†åˆ« â­
```

#### æ ¸å¿ƒç‰¹ç‚¹

| ç‰¹æ€§ | å†…å®¹ |
|------|------|
| **æ‹¼æ¥å™¨** | metaFlyeï¼ˆå•æ‹¼æ¥å™¨ï¼Œä½†ä¿å­˜å®Œæ•´è¾“å‡ºï¼‰|
| **ç—…æ¯’è¯†åˆ«** | VirSorter2 + DeepVirFinder + **viralFlye**ï¼ˆä¸‰å·¥å…·å¹¶åˆ—ï¼‰â­ |
| **ç»¼åˆæ¯”è¾ƒ** | **ä¸‰å·¥å…·æ¯”è¾ƒ**ï¼ˆVS2 vs DVF vs viralFlyeï¼‰â­â­â­ |
| **å…±è¯†ç­–ç•¥** | 1-3 å·¥å…·å…±è¯†åˆ†å±‚ï¼ˆç»†è‡´çš„ç½®ä¿¡åº¦åˆ†çº§ï¼‰|
| **viralFlye** | âœ… **æ”¯æŒ**ï¼ˆPfam è›‹ç™½éªŒè¯ï¼‰â­ |

#### ä¼˜åŠ¿

- âœ… **ä¸‰ç§ç‹¬ç«‹æ–¹æ³•**éªŒè¯
- âœ… **Pfam è›‹ç™½ç»“æ„åŸŸ**éªŒè¯ï¼ˆviralFlye ç‹¬æœ‰ï¼‰
- âœ… **ç½®ä¿¡åº¦åˆ†å±‚**ï¼ˆ1/2/3 å·¥å…·å…±è¯†ï¼‰
- âœ… å¯è¯†åˆ«**æ–°å‹ç—…æ¯’**ï¼ˆviralFlye åŸºäºåŠŸèƒ½ï¼Œä¸ä¾èµ–åºåˆ—ç›¸ä¼¼æ€§ï¼‰
- âœ… è¯„ä¼°ç—…æ¯’**åŸºå› ç»„å®Œæ•´æ€§**ï¼ˆviralCompleteï¼‰
- âœ… ä¿å­˜**å®Œæ•´ metaFlye è¾“å‡º**ï¼ˆassembly_info.txt, assembly_graph.gfaï¼‰

#### è¾“å‡ºç¤ºä¾‹

```
results_long/
â”œâ”€â”€ assembly_metaflye/            # metaFlye contigs
â”œâ”€â”€ metaflye_full_output/         # metaFlye å®Œæ•´è¾“å‡º â­
â”‚   â””â”€â”€ sample_flye_output/
â”‚       â”œâ”€â”€ assembly_info.txt     # æ‹¼æ¥ç»Ÿè®¡
â”‚       â””â”€â”€ assembly_graph.gfa    # æ‹¼æ¥å›¾
â”œâ”€â”€ virsorter2_metaflye/          # VS2 è¯†åˆ«
â”œâ”€â”€ deepvirfinder_metaflye/       # DVF è¯†åˆ«
â”œâ”€â”€ viralflye_results/            # viralFlye è¯†åˆ« â­
â”‚   â”œâ”€â”€ sample_viralflye_contigs.fa
â”‚   â””â”€â”€ sample_viralflye_summary.csv
â””â”€â”€ three_tools_comparison/       # ä¸‰å·¥å…·æ¯”è¾ƒ â­â­â­
    â”œâ”€â”€ sample_three_tools_comparison.txt
    â”œâ”€â”€ sample_three_tools_comparison.csv
    â””â”€â”€ sample_high_confidence_viruses.txt
```

---

## ğŸ¯ è¯¦ç»†å¯¹æ¯”è¡¨

| å¯¹æ¯”é¡¹ | çŸ­è¯»æ¨¡å¼ | é•¿è¯»æ¨¡å¼ |
|--------|---------|---------|
| **æ•°æ®ç±»å‹** | Illumina åŒç«¯ | Nanopore/PacBio å•ç«¯ |
| **Read é•¿åº¦** | 150-300 bp | 1-100 kb |
| **æ‹¼æ¥å™¨æ•°é‡** | 2ä¸ªï¼ˆMEGAHIT + SPAdesï¼‰| 1ä¸ªï¼ˆmetaFlyeï¼‰|
| **ç—…æ¯’è¯†åˆ«å·¥å…·** | 2ä¸ªï¼ˆVS2 + DVFï¼‰| 3ä¸ªï¼ˆVS2 + DVF + viralFlyeï¼‰â­ |
| **ç‰¹è‰²å·¥å…·** | - | **viralFlye**ï¼ˆPfaméªŒè¯ï¼‰â­ |
| **æ¯”è¾ƒç­–ç•¥** | æ‹¼æ¥å™¨æ¯”è¾ƒ | å·¥å…·æ¯”è¾ƒ |
| **ç½®ä¿¡åº¦çº§åˆ«** | 2çº§ï¼ˆåŒå·¥å…·ã€å•å·¥å…·ï¼‰| 4çº§ï¼ˆ3å·¥å…·ã€2å·¥å…·ã€1å·¥å…·ã€viralFlyeç‹¬æœ‰ï¼‰â­ |
| **Pfam æ•°æ®åº“** | âŒ ä¸éœ€è¦ | âœ… éœ€è¦ |
| **è®¡ç®—æ—¶é—´** | 24-48hï¼ˆä¸­ç­‰æ•°æ®ï¼‰| 48-72hï¼ˆä¸­ç­‰æ•°æ®ï¼‰|
| **å†…å­˜éœ€æ±‚** | 64-512 GBï¼ˆSPAdesï¼‰| 128-256 GB |
| **ç—…æ¯’è´¨é‡** | ä¸­-é«˜ | é«˜ï¼ˆviralFlye éªŒè¯ï¼‰â­ |
| **æ–°å‹ç—…æ¯’å‘ç°** | ä¸­ç­‰ | å¼ºï¼ˆviralFlye åŸºäºåŠŸèƒ½ï¼‰â­ |

---

## ğŸ” å¦‚ä½•é€‰æ‹©æ¨¡å¼ï¼Ÿ

### åœºæ™¯1ï¼šåªæœ‰ Illumina æ•°æ®

```
æµ‹åºæ•°æ®ï¼šIllumina HiSeq/NovaSeq
Read ç±»å‹ï¼šåŒç«¯ï¼Œ150 bp

é€‰æ‹©ï¼šçŸ­è¯»æ¨¡å¼
å‘½ä»¤ï¼šsbatch run_metagenome_assembly_classification_shortread_en.sh

è·å¾—ï¼š
- åŒæ‹¼æ¥å™¨ç»“æœ
- åŒå·¥å…·ç—…æ¯’è¯†åˆ«
- æ‹¼æ¥å™¨å…±è¯†ç—…æ¯’
```

### åœºæ™¯2ï¼šåªæœ‰é•¿è¯»æ•°æ®

```
æµ‹åºæ•°æ®ï¼šNanopore MinION/PromethION
Read ç±»å‹ï¼šå•ç«¯ï¼Œå¹³å‡ 5-10 kb

é€‰æ‹©ï¼šé•¿è¯»æ¨¡å¼ + å¯ç”¨ viralFlye â­
å‘½ä»¤ï¼šsbatch run_metagenome_assembly_classification_longread_en.sh
      (ç¡®ä¿ ENABLE_VIRALFLYE="true")

è·å¾—ï¼š
- metaFlye æ‹¼æ¥
- ä¸‰å·¥å…·ç—…æ¯’è¯†åˆ«
- Pfam è›‹ç™½éªŒè¯
- ä¸‰å·¥å…·ç»¼åˆæ¯”è¾ƒ â­â­â­
```

### åœºæ™¯3ï¼šåŒæ—¶æœ‰çŸ­è¯»å’Œé•¿è¯»

```
æµ‹åºæ•°æ®ï¼šIllumina + Nanoporeï¼ˆæ··åˆæµ‹åºï¼‰

é€‰æ‹©ï¼šè¿è¡Œä¸¤æ¬¡
1. çŸ­è¯»æ¨¡å¼ï¼ˆIlluminaï¼‰
2. é•¿è¯»æ¨¡å¼ï¼ˆNanopore + viralFlyeï¼‰

ç„¶åæ‰‹åŠ¨æ¯”è¾ƒä¸¤ç§æ¨¡å¼çš„ç»“æœ
```

---

## ğŸ’¡ viralFlye ä¸ºä»€ä¹ˆåªæ”¯æŒé•¿è¯»ï¼Ÿ

### æŠ€æœ¯åŸå› 

1. **éœ€è¦ Flye è¾“å‡ºç»“æ„**
   - viralFlye è®¾è®¡ç”¨äºå¤„ç† Flye/metaFlye çš„è¾“å‡ºç›®å½•
   - éœ€è¦ assembly_graph.gfaï¼ˆæ‹¼æ¥å›¾ï¼‰
   - éœ€è¦ assembly_info.txtï¼ˆæ‹¼æ¥ç»Ÿè®¡ï¼‰

2. **Flye åªæ”¯æŒé•¿è¯»**
   - Flye æ˜¯é•¿è¯»ä¸“ç”¨æ‹¼æ¥å™¨
   - ä¸æ”¯æŒçŸ­è¯»æ•°æ®
   - MEGAHIT/SPAdes è¾“å‡ºç»“æ„å®Œå…¨ä¸åŒ

3. **é•¿è¯»çš„ä¼˜åŠ¿**
   - æ›´å®¹æ˜“è·å¾—å®Œæ•´ç—…æ¯’åŸºå› ç»„
   - viralFlye æ›´æœ‰æ•ˆï¼ˆéœ€è¦å¤šä¸ªè›‹ç™½ç¼–ç åŸºå› ï¼‰
   - Pfam éªŒè¯éœ€è¦è¶³å¤Ÿé•¿çš„åºåˆ—

### çŸ­è¯»æ•°æ®çš„æ›¿ä»£æ–¹æ¡ˆ

**çŸ­è¯»æ¨¡å¼å·²ç»æœ‰å¾ˆå¥½çš„éªŒè¯ç­–ç•¥**ï¼š

1. **åŒæ‹¼æ¥å™¨å…±è¯†** â­
   - MEGAHIT å’Œ SPAdes éƒ½è¯†åˆ«çš„ç—…æ¯’
   - éå¸¸å¯é 

2. **åŒå·¥å…·å…±è¯†**
   - VirSorter2 å’Œ DeepVirFinder éƒ½è¯†åˆ«çš„
   - é«˜ç½®ä¿¡åº¦

3. **å·¥å…·ç»„åˆ**
   - VS2 + DVF çš„ç»“åˆå·²ç»å¾ˆå¼ºå¤§
   - è¦†ç›–ä¸åŒç±»å‹çš„ç—…æ¯’

**ç»“è®º**ï¼šçŸ­è¯»æ¨¡å¼è™½ç„¶æ²¡æœ‰ viralFlyeï¼Œä½†é€šè¿‡åŒæ‹¼æ¥å™¨+åŒå·¥å…·çš„ç»„åˆï¼Œå·²ç»èƒ½æä¾›å¯é çš„ç—…æ¯’è¯†åˆ«ã€‚

---

## ğŸ¯ æ¨èé…ç½®

### çŸ­è¯»æ¨¡å¼æœ€ä½³é…ç½®

```groovy
// åŒæ‹¼æ¥å™¨ + åŒå·¥å…·
params {
    skip_fastp = false              // å¯ç”¨è´¨æ§
    
    // VirSorter2
    virsorter2_min_score = 0.5
    virsorter2_min_length = 1000
    
    // DeepVirFinder
    deepvirfinder_pvalue = 0.01     // â­ å»ºè®®0.01ï¼ˆå‡å°‘å‡é˜³æ€§ï¼‰
    deepvirfinder_min_length = 1000
}

é‡ç‚¹å…³æ³¨ï¼š
- assembler_comparison/: æ‹¼æ¥å™¨æ¯”è¾ƒ â­â­â­
- consensus_viral_sequences.txt: åŒæ‹¼æ¥å™¨å…±è¯†ç—…æ¯’
```

### é•¿è¯»æ¨¡å¼æœ€ä½³é…ç½®ï¼ˆä¸‰å·¥å…·ï¼‰â­

```groovy
// ä¸‰å·¥å…·å¹¶åˆ—åˆ†æ
params {
    longread = true
    longread_platform = 'nano'      // æˆ– 'pacbio'
    enable_viralflye = true         // â­ å¯ç”¨ç¬¬ä¸‰ä¸ªå·¥å…·
    
    // viralFlyeï¼ˆPfam éªŒè¯ï¼‰â­â­â­
    viralflye_min_length = 500          // â­ ä¼˜åŒ–ï¼šè¯†åˆ«è¾ƒçŸ­ç—…æ¯’
    viralflye_completeness = 0.3        // â­â­â­ å®Œæ•´æ€§é˜ˆå€¼ï¼ˆå…³é”®å‚æ•°ï¼ï¼‰
    // è¯´æ˜ï¼š
    //   0.5 (é»˜è®¤) = åªè¯†åˆ«é«˜åº¦å®Œæ•´çš„ç—…æ¯’ (2-5ä¸ª)
    //   0.3 (æ¨è) = å¹³è¡¡è´¨é‡å’Œæ•°é‡ (10-20ä¸ª) â­â­
    //   0.2 (æ¿€è¿›) = è¯†åˆ«æ›´å¤šç—…æ¯’ (20-40ä¸ª)
    pfam_db = '/path/to/Pfam-A.hmm'
    
    // VirSorter2
    virsorter2_min_score = 0.5
    virsorter2_min_length = 1000
    
    // DeepVirFinder
    deepvirfinder_pvalue = 0.01     // â­ ä¼˜åŒ–ï¼šå‡å°‘å‡é˜³æ€§
    deepvirfinder_min_length = 1000
}

é‡ç‚¹å…³æ³¨ï¼š
- three_tools_comparison/: ä¸‰å·¥å…·ç»¼åˆæ¯”è¾ƒ â­â­â­
- high_confidence_viruses.txt: æŒ‰å…±è¯†åº¦åˆ†å±‚çš„ç—…æ¯’åˆ—è¡¨
- viralflye_results/: Pfam éªŒè¯çš„ç—…æ¯’ï¼ˆæ•°é‡æ˜¾è‘—å¢åŠ ï¼‰â­
```

---

## ğŸ“‹ åŠŸèƒ½å¯¹æ¯”

### çŸ­è¯»æ¨¡å¼åŠŸèƒ½

âœ… **æœ‰çš„åŠŸèƒ½**ï¼š
- fastp è´¨æ§
- MEGAHIT æ‹¼æ¥
- metaSPAdes æ‹¼æ¥
- VirSorter2 ç—…æ¯’è¯†åˆ«ï¼ˆMEGAHITï¼‰
- VirSorter2 ç—…æ¯’è¯†åˆ«ï¼ˆSPAdesï¼‰
- DeepVirFinder è¯†åˆ«ï¼ˆMEGAHITï¼‰
- DeepVirFinder è¯†åˆ«ï¼ˆSPAdesï¼‰
- åŒæ‹¼æ¥å™¨ç»“æœæ•´åˆ
- æ‹¼æ¥å™¨æ¯”è¾ƒå’Œå…±è¯†

âŒ **æ²¡æœ‰çš„åŠŸèƒ½**ï¼š
- viralFlye ç—…æ¯’è¯†åˆ«
- Pfam è›‹ç™½éªŒè¯
- ä¸‰å·¥å…·ç»¼åˆæ¯”è¾ƒ
- viralComplete å®Œæ•´æ€§è¯„ä¼°

### é•¿è¯»æ¨¡å¼åŠŸèƒ½

âœ… **æœ‰çš„åŠŸèƒ½**ï¼š
- metaFlye æ‹¼æ¥
- ä¿å­˜å®Œæ•´ metaFlye è¾“å‡ºï¼ˆassembly_info, assembly_graphï¼‰â­
- VirSorter2 ç—…æ¯’è¯†åˆ«
- DeepVirFinder è¯†åˆ«
- **viralFlye ç—…æ¯’è¯†åˆ«**ï¼ˆPfam éªŒè¯ï¼‰â­
- **ä¸‰å·¥å…·ç»¼åˆæ¯”è¾ƒ**ï¼ˆVS2 vs DVF vs viralFlyeï¼‰â­â­â­
- **ç½®ä¿¡åº¦åˆ†å±‚**ï¼ˆ1-3 å·¥å…·å…±è¯†ï¼‰
- viralComplete å®Œæ•´æ€§è¯„ä¼°
- viralVerify ç—…æ¯’/ç»†èŒ/è´¨ç²’åˆ†ç±»

âŒ **æ²¡æœ‰çš„åŠŸèƒ½**ï¼š
- åŒæ‹¼æ¥å™¨æ¯”è¾ƒï¼ˆåªæœ‰ä¸€ä¸ªæ‹¼æ¥å™¨ï¼‰

---

## ğŸ¯ ç»“æœè´¨é‡å¯¹æ¯”

### çŸ­è¯»æ¨¡å¼

**éªŒè¯ç­–ç•¥**ï¼šåŒæ‹¼æ¥å™¨ + åŒå·¥å…·

```
åŒæ‹¼æ¥å™¨å…±è¯†ç—…æ¯’ï¼š
- MEGAHIT è¯†åˆ« âˆ© SPAdes è¯†åˆ«
- ç½®ä¿¡åº¦ï¼šé«˜ â­â­
- æ•°é‡ï¼šä¸­ç­‰

åŒå·¥å…·å…±è¯†ç—…æ¯’ï¼š
- VirSorter2 âˆ© DeepVirFinder
- ç½®ä¿¡åº¦ï¼šé«˜ â­â­
- æ•°é‡ï¼šæ¯ä¸ªæ‹¼æ¥å™¨éƒ½æœ‰

æœ€é«˜ç½®ä¿¡åº¦ï¼š
- åŒæ‹¼æ¥å™¨ âˆ© åŒå·¥å…·
- ç½®ä¿¡åº¦ï¼šæé«˜ â­â­â­
```

### é•¿è¯»æ¨¡å¼ï¼ˆå¯ç”¨ viralFlyeï¼‰

**éªŒè¯ç­–ç•¥**ï¼šä¸‰å·¥å…·å¹¶åˆ—

```
ä¸‰å·¥å…·å…±è¯†ç—…æ¯’ï¼š
- VS2 âˆ© DVF âˆ© viralFlye
- ç½®ä¿¡åº¦ï¼šæœ€é«˜ â­â­â­
- æ•°é‡ï¼š5-15 ä¸ª

ä¸¤å·¥å…·å…±è¯†ç—…æ¯’ï¼š
- VS2 âˆ© DVF, VS2 âˆ© viralFlye, DVF âˆ© viralFlye
- ç½®ä¿¡åº¦ï¼šé«˜ â­â­
- æ•°é‡ï¼š20-50 ä¸ª

viralFlye ç‹¬æœ‰ï¼š
- ç»è¿‡ Pfam è›‹ç™½éªŒè¯
- ç½®ä¿¡åº¦ï¼šé«˜ï¼ˆé«˜ç‰¹å¼‚æ€§ï¼‰â­â­
- æ•°é‡ï¼šå¯èƒ½æœ‰ viralFlye ç‹¬è‡ªå‘ç°çš„ç—…æ¯’

å•å·¥å…·è¯†åˆ«ï¼š
- åªæœ‰ä¸€ä¸ªå·¥å…·è¯†åˆ«
- ç½®ä¿¡åº¦ï¼šä¸­-ä½ â­
- æ•°é‡ï¼šè¾ƒå¤šï¼ˆæ¢ç´¢æ€§ï¼‰
```

---

## ğŸ”¬ viralFlye çš„ç‹¬ç‰¹ä»·å€¼ï¼ˆé•¿è¯»ä¸“å±ï¼‰

### ä¸ºä»€ä¹ˆé•¿è¯»æ¨¡å¼æ›´å¼ºå¤§ï¼Ÿ

**å› ä¸ºæœ‰ viralFlyeï¼** â­

#### 1. Pfam è›‹ç™½éªŒè¯

```
viralFlye ä½¿ç”¨ Pfam æ•°æ®åº“ï¼ˆ~20,000 ä¸ªè›‹ç™½å®¶æ—ï¼‰
    â†“
è¯†åˆ«è›‹ç™½ç»“æ„åŸŸ
    â†“
æ ¹æ®ç»“æ„åŸŸç»„åˆæ¨¡å¼åˆ¤æ–­ï¼š
- ç—…æ¯’ç‰¹å¾ç»„åˆ â†’ Virus âœ…
- ç»†èŒç‰¹å¾ç»„åˆ â†’ Chromosome
- è´¨ç²’ç‰¹å¾ç»„åˆ â†’ Plasmid
```

**ä¼˜åŠ¿**ï¼š
- åŸºäºè›‹ç™½**åŠŸèƒ½**ï¼Œä¸åªæ˜¯åºåˆ—ç›¸ä¼¼æ€§
- å¯ä»¥å‘ç°**å…¨æ–°çš„ç—…æ¯’**
- å‡†ç¡®åŒºåˆ†ç—…æ¯’ã€ç»†èŒã€è´¨ç²’

#### 2. å®Œæ•´æ€§è¯„ä¼°

viralFlye åŒ…å« viralComplete ç»„ä»¶ï¼š
- è¯„ä¼°ç—…æ¯’åŸºå› ç»„å®Œæ•´æ€§
- æ ‡è®°å®Œæ•´/éƒ¨åˆ†ç—…æ¯’åŸºå› ç»„
- æä¾›ç½®ä¿¡åº¦è¯„åˆ†

#### 3. ç¯çŠ¶/çº¿æ€§è¯†åˆ«

- è¯†åˆ«ç¯çŠ¶ç—…æ¯’åŸºå› ç»„
- è¯†åˆ«çº¿æ€§ç—…æ¯’åŸºå› ç»„
- å¾ˆå¤šå™¬èŒä½“æ˜¯ç¯çŠ¶çš„ â­

### å®é™…æ¡ˆä¾‹

**æ ·æœ¬**: llnl_66d1047e

**viralFlye è¯†åˆ«çš„ 2 ä¸ªç—…æ¯’**ï¼ˆä½¿ç”¨é»˜è®¤å‚æ•°ï¼‰ï¼š

```
contig_1085: 39,632 bp
- ç±»å‹ï¼šç¯çŠ¶ç—…æ¯’
- Pfam ç‰¹å¾ï¼šPhage_Mu_F, Portal_Mu, Phage_tail_terminator
- è¯„åˆ†ï¼š33.68
- åˆ†ç±»ï¼šMu å™¬èŒä½“

contig_1192: 17,488 bp
- ç±»å‹ï¼šç¯çŠ¶ç—…æ¯’
- Pfam ç‰¹å¾ï¼šTerL_ATPase, Phage_capsid, Phage_portal
- è¯„åˆ†ï¼š25.93
- åˆ†ç±»ï¼šé•¿å°¾å™¬èŒä½“ï¼ˆSiphoviridaeï¼‰
```

**è¿™ä¸¤ä¸ªéƒ½æ˜¯é«˜è´¨é‡çš„å®Œæ•´å™¬èŒä½“åŸºå› ç»„ï¼**

**ä½¿ç”¨ä¼˜åŒ–å‚æ•°å** â­â­â­ï¼š
```groovy
viralflye_min_length = 500          // â­ è¯†åˆ«è¾ƒçŸ­ç—…æ¯’
viralflye_completeness = 0.3        // â­â­â­ é™ä½å®Œæ•´æ€§é˜ˆå€¼ï¼ˆå…³é”®ï¼ï¼‰
```

**é¢„æœŸæ•ˆæœ**ï¼š
- viralFlye è¯†åˆ«ï¼š**10-20 ä¸ªç—…æ¯’**ï¼ˆä» 2 ä¸ªå¢åŠ åˆ° 10-20 ä¸ªï¼‰â­â­
- åŒ…æ‹¬ï¼š
  - å®Œæ•´ç¯çŠ¶ç—…æ¯’ï¼ˆåŸæœ‰çš„ 2 ä¸ªï¼‰
  - è¾ƒå®Œæ•´çš„çº¿æ€§ç—…æ¯’ï¼ˆæ–°å¢ï¼‰
  - å¤§å‹ç—…æ¯’ç‰‡æ®µï¼ˆæ–°å¢ï¼‰
- è´¨é‡ï¼šä»ç„¶é«˜ï¼ˆç»è¿‡ Pfam éªŒè¯ï¼‰

**å…³é”®ç†è§£**ï¼š
- `min_length = 500`ï¼šæ”¾å®½é•¿åº¦é™åˆ¶
- `completeness = 0.3`ï¼š**è¿™æ‰æ˜¯å…³é”®å‚æ•°ï¼** â­â­â­
  - é»˜è®¤ 0.5 è¦æ±‚ 50% å®Œæ•´æ€§ï¼ˆå¾ˆä¸¥æ ¼ï¼‰
  - é™åˆ° 0.3 è¦æ±‚ 30% å®Œæ•´æ€§ï¼ˆå¹³è¡¡ï¼‰
  - è¿™ä¸ªå‚æ•°å¯¹ç—…æ¯’æ•°é‡å½±å“æœ€å¤§

---

## âš™ï¸ æ¨¡å¼é…ç½®

### çŸ­è¯»æ¨¡å¼é…ç½®

```bash
# samplesheet.csv
sample,fastq_1,fastq_2
s1,/path/to/R1.fastq.gz,/path/to/R2.fastq.gz

# è¿è¡Œ
sbatch run_metagenome_assembly_classification_shortread_en.sh

# æˆ–å‘½ä»¤è¡Œ
nextflow run metagenome_assembly_classification_workflow_en.nf \
    --input samplesheet.csv \
    --outdir results \
    --virsorter2_db /path/to/db \
    --deepvirfinder_dir /path/to/DVF
    # ä¸éœ€è¦ --longread æˆ– --enable_viralflye
```

### é•¿è¯»æ¨¡å¼é…ç½®ï¼ˆåŸºç¡€ï¼‰

```bash
# samplesheet_long.csv
sample,fastq_long
s1,/path/to/nanopore.fastq.gz

# è¿è¡Œï¼ˆä¸å¯ç”¨ viralFlyeï¼‰
nextflow run metagenome_assembly_classification_workflow_en.nf \
    --input samplesheet_long.csv \
    --outdir results_long \
    --virsorter2_db /path/to/db \
    --deepvirfinder_dir /path/to/DVF \
    --longread true \
    --longread_platform nano
    # åªæœ‰ VS2 + DVFï¼Œæ²¡æœ‰ viralFlye
```

### é•¿è¯»æ¨¡å¼é…ç½®ï¼ˆå®Œæ•´ä¸‰å·¥å…·ï¼‰â­

```bash
# samplesheet_long.csv
sample,fastq_long
s1,/path/to/nanopore.fastq.gz

# è¿è¡Œï¼ˆå¯ç”¨ viralFlyeï¼‰
sbatch run_metagenome_assembly_classification_longread_en.sh
# æˆ–
nextflow run metagenome_assembly_classification_workflow_en.nf \
    --input samplesheet_long.csv \
    --outdir results_long \
    --virsorter2_db /path/to/db \
    --deepvirfinder_dir /path/to/DVF \
    --longread true \
    --longread_platform nano \
    --enable_viralflye true \               # â­ å¯ç”¨ç¬¬ä¸‰ä¸ªå·¥å…·
    --pfam_db /path/to/Pfam-A.hmm \
    --viralflye_env /path/to/viralFlye_env \
    --viralflye_min_length 500 \            # â­ ä¼˜åŒ–ï¼šè¯†åˆ«è¾ƒçŸ­ç—…æ¯’
    --viralflye_completeness 0.3            # â­â­â­ å®Œæ•´æ€§é˜ˆå€¼ï¼ˆå…³é”®ï¼ï¼‰
```

---

## âœ… æ¨èé€‰æ‹©

### å¦‚æœæœ‰ Illumina æ•°æ®

```
âœ… ä½¿ç”¨çŸ­è¯»æ¨¡å¼
âœ… åŒæ‹¼æ¥å™¨å¹¶è¡Œï¼ˆMEGAHIT + SPAdesï¼‰
âœ… åŒå·¥å…·éªŒè¯ï¼ˆVirSorter2 + DeepVirFinderï¼‰
âœ… å…³æ³¨æ‹¼æ¥å™¨å…±è¯†ç—…æ¯’

è¿è¡Œï¼šsbatch run_metagenome_assembly_classification_shortread_en.sh
```

### å¦‚æœæœ‰ Nanopore/PacBio æ•°æ®ï¼ˆæ¨èï¼‰â­â­â­

```
âœ… ä½¿ç”¨é•¿è¯»æ¨¡å¼
âœ… å¯ç”¨ viralFlyeï¼ˆè·å¾— Pfam éªŒè¯ï¼‰â­
âœ… ä¸‰å·¥å…·å¹¶åˆ—åˆ†æ
âœ… å…³æ³¨ä¸‰å·¥å…·å…±è¯†å’Œ viralFlye ç‹¬æœ‰çš„ç—…æ¯’

è¿è¡Œï¼šsbatch run_metagenome_assembly_classification_longread_en.sh
      ç¡®ä¿ ENABLE_VIRALFLYE="true"
```

---

## ğŸš¨ viralFlye å‚æ•°ä¼˜åŒ–é‡è¦æç¤º â­â­â­

### é—®é¢˜ï¼šviralFlye åªè¯†åˆ« 2 ä¸ªç—…æ¯’ï¼Ÿ

å¦‚æœä½ çš„ viralFlye è¾“å‡ºå¾ˆå°‘ç—…æ¯’ï¼ˆä¾‹å¦‚åªæœ‰ 2 ä¸ªï¼‰ï¼Œ**ä¸è¦åªé™ä½ `min_length`**ï¼

### è§£å†³æ–¹æ¡ˆ

**å…³é”®å‚æ•°æ˜¯ `viralflye_completeness`**ï¼ˆå®Œæ•´æ€§é˜ˆå€¼ï¼‰ï¼š

```groovy
// âŒ ä¸å¤Ÿçš„ä¼˜åŒ–
viralflye_min_length = 500          // åªæ”¹è¿™ä¸ªæ•ˆæœæœ‰é™

// âœ… æ­£ç¡®çš„ä¼˜åŒ–
viralflye_min_length = 500          // â­ è¯†åˆ«è¾ƒçŸ­ç—…æ¯’
viralflye_completeness = 0.3        // â­â­â­ è¿™æ‰æ˜¯å…³é”®ï¼
```

### ä¸ºä»€ä¹ˆï¼Ÿ

viralFlye æœ‰å¤šå±‚è¿‡æ»¤ï¼š
1. **é•¿åº¦è¿‡æ»¤**ï¼ˆmin_lengthï¼‰- æ”¾å®½åå¯ä»¥é€šè¿‡
2. Pfam åˆ†ç±»
3. **å®Œæ•´æ€§è¯„ä¼°**ï¼ˆcompletenessï¼‰- **è¿™æ˜¯ä¸»è¦ç“¶é¢ˆï¼** â­â­â­
4. viralComplete éªŒè¯

é»˜è®¤ `completeness = 0.5`ï¼ˆè¦æ±‚ 50% å®Œæ•´æ€§ï¼‰å¤ªä¸¥æ ¼äº†ï¼

### æ¨èé…ç½®

| completeness | ç—…æ¯’æ•°é‡ | è´¨é‡ | ç”¨é€” |
|--------------|---------|------|------|
| 0.5 (é»˜è®¤) | 2-5 ä¸ª | æé«˜ | å‘è¡¨çº§ |
| **0.3 (æ¨è)** | **10-20 ä¸ª** | é«˜ â­â­ | **å¸¸è§„åˆ†æ** â­â­â­ |
| 0.2 | 20-40 ä¸ª | ä¸­-é«˜ | æ¢ç´¢æ€§ |

### è¯¦ç»†æŒ‡å—

å‚è§ï¼š
- **`viralFlyeå‚æ•°ä¼˜åŒ–æŒ‡å—.md`** - å®Œæ•´çš„ä¼˜åŒ–æŒ‡å—
- **`viralFlyeä¼˜åŒ–_å¿«é€Ÿå‚è€ƒ.md`** - å¿«é€Ÿå‚è€ƒå¡

---

## ğŸ‰ æ€»ç»“

### æ ¸å¿ƒåŒºåˆ«

| | çŸ­è¯»æ¨¡å¼ | é•¿è¯»æ¨¡å¼ |
|-|---------|---------|
| **ç­–ç•¥** | åŒæ‹¼æ¥å™¨ç­–ç•¥ | ä¸‰å·¥å…·ç­–ç•¥ â­ |
| **ç‹¬ç‰¹åŠŸèƒ½** | æ‹¼æ¥å™¨æ¯”è¾ƒ | viralFlye + Pfam éªŒè¯ â­ |
| **ç½®ä¿¡åº¦** | åŒé‡éªŒè¯ | ä¸‰é‡éªŒè¯ â­â­â­ |

### å…³é”®ç†è§£

1. **viralFlye æ˜¯é•¿è¯»æ¨¡å¼çš„ç‹¬ç‰¹ä¼˜åŠ¿** â­
   - æä¾› Pfam è›‹ç™½éªŒè¯
   - å¯å‘ç°æ–°å‹ç—…æ¯’
   - è¯„ä¼°åŸºå› ç»„å®Œæ•´æ€§

2. **çŸ­è¯»æ¨¡å¼æœ‰è‡ªå·±çš„ä¼˜åŠ¿**
   - åŒæ‹¼æ¥å™¨äº¤å‰éªŒè¯
   - æˆæœ¬è¾ƒä½
   - æŠ€æœ¯æˆç†Ÿ

3. **ä¸¤ç§æ¨¡å¼éƒ½æœ‰åŒå·¥å…·ç—…æ¯’è¯†åˆ«**
   - VirSorter2 + DeepVirFinder
   - è¿™æ˜¯ä¸¤ç§æ¨¡å¼çš„å…±åŒåŸºç¡€

---

**é€‰æ‹©åˆé€‚çš„æ¨¡å¼ï¼Œå¼€å§‹ä½ çš„ç—…æ¯’å®åŸºå› ç»„åˆ†æï¼** ğŸš€

**ç›¸å…³æ–‡æ¡£**ï¼š
- **`README.md`** - å®Œæ•´ç”¨æˆ·æŒ‡å—
- **`æ–¹æ¡ˆA_ä¸‰å·¥å…·å¹¶åˆ—åˆ†æè¯´æ˜.md`** - é•¿è¯»æ¨¡å¼è¯¦ç»†è®¾è®¡
- **`æé«˜ç—…æ¯’è¯†åˆ«æ•°é‡æŒ‡å—.md`** - ç»¼åˆå‚æ•°ä¼˜åŒ–æŒ‡å—
- **`viralFlyeå‚æ•°ä¼˜åŒ–æŒ‡å—.md`** â­â­â­ - viralFlye ä¸“é¡¹ä¼˜åŒ–ï¼ˆé‡è¦ï¼ï¼‰
- **`viralFlyeä¼˜åŒ–_å¿«é€Ÿå‚è€ƒ.md`** â­â­ - viralFlye å¿«é€Ÿå‚è€ƒå¡

